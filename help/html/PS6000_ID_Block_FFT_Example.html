
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>PicoScope 6000 Series Instrument Driver Oscilloscope Block Data Capture with FFT Example</title><meta name="generator" content="MATLAB 9.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2017-05-03"><meta name="DC.source" content="PS6000_ID_Block_FFT_Example.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>PicoScope 6000 Series Instrument Driver Oscilloscope Block Data Capture with FFT Example</h1><!--introduction--><p>This is an example of an instrument control session using a device object. The instrument control session comprises all the steps you are likely to take when communicating with your instrument.</p><p>These steps are:</p><div><ol><li>Create a device object</li><li>Connect to the instrument</li><li>Configure properties</li><li>Invoke functions</li><li>Disconnect from the instrument</li></ol></div><p>To run the instrument control session, type the name of the file, PS6000_ID_Block_Example_FFT, at the MATLAB command prompt.</p><p>The file, PS6000_ID_BLOCK_FFT_EXAMPLE.M must be on your MATLAB PATH. For additional information on setting your MATLAB PATH, type 'help addpath' at the MATLAB command prompt.</p><p><b>Example:</b>     PS6000_ID_Block_FFT_Example;</p><p><b>Description:</b>     Demonstrates how to set properties and call functions in order to capture a block of     data from a PicoScope 6000 Series Oscilloscope and calculate a Fast     Fourier Transform (FFT) on the data collected.</p><p><b>See also:</b> <a href="matlab:doc('fft')"><tt>fft</tt></a> | <a href="matlab:doc('icdevice')"><tt>icdevice</tt></a> | <a href="matlab:doc('instrument/invoke')"><tt>invoke</tt></a></p><p><b>Copyright:</b> &copy; 2014 - 2017 Pico Technology Ltd. See LICENSE file for terms.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Suggested Input Test Signal</a></li><li><a href="#2">Clear Command Window and Close any Figures</a></li><li><a href="#3">Load Configuration Information</a></li><li><a href="#4">Device Connection</a></li><li><a href="#5">Set Channels</a></li><li><a href="#6">Verify Timebase Index and Maximum Number of Samples</a></li><li><a href="#7">Set Simple Trigger</a></li><li><a href="#8">Set Block Parameters and Capture Data</a></li><li><a href="#10">Process Data</a></li><li><a href="#11">Disconnect Device</a></li></ul></div><h2 id="1">Suggested Input Test Signal</h2><p>This example was published using the following test signal:</p><div><ul><li>Channel A: 4 Vpp, 50 Hz square wave</li></ul></div><h2 id="2">Clear Command Window and Close any Figures</h2><pre class="codeinput">clc;
close <span class="string">all</span>;
</pre><h2 id="3">Load Configuration Information</h2><pre class="codeinput">PS6000Config;
</pre><h2 id="4">Device Connection</h2><pre class="codeinput"><span class="comment">% Check if an Instrument session using the device object 'ps6000DeviceObj'</span>
<span class="comment">% is still open, and if so, disconnect if the User chooses 'Yes' when prompted.</span>
<span class="keyword">if</span> (exist(<span class="string">'ps6000DeviceObj'</span>, <span class="string">'var'</span>) &amp;&amp; ps6000DeviceObj.isvalid &amp;&amp; strcmp(ps6000DeviceObj.status, <span class="string">'open'</span>))

    openDevice = questionDialog([<span class="string">'Device object ps6000DeviceObj has an open connection. '</span> <span class="keyword">...</span>
        <span class="string">'Do you wish to close the connection and continue?'</span>], <span class="keyword">...</span>
        <span class="string">'Device Object Connection Open'</span>);

    <span class="keyword">if</span> (openDevice == PicoConstants.TRUE)

        <span class="comment">% Close connection to device</span>
        disconnect(ps6000DeviceObj);
        delete(ps6000DeviceObj);

    <span class="keyword">else</span>

        <span class="comment">% Exit script if User selects 'No'</span>
        <span class="keyword">return</span>;

    <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="comment">% Create a device object.</span>
<span class="comment">% The serial number can be specified as a second input parameter.</span>
ps6000DeviceObj = icdevice(<span class="string">'picotech_ps6000_generic.mdd'</span>);

<span class="comment">% Connect device object to hardware.</span>
connect(ps6000DeviceObj);
</pre><pre class="codeoutput">
Copyright &copy; 2014 - 2017 Pico Technology Ltd. All rights reserved.

PicoScope 6000 Series MATLAB Instrument Driver

Number of units found: 1

Serial number(s): EW421/006

Opening PicoScope 6000 Series device...

   Instrument Device Object Using Driver : picotech_ps6000_generic.mdd
 
   Instrument Information
      Type:               Oscilloscope
      Manufacturer:       Pico Technology Ltd.
      Model:              PicoScope 6000 Series
 
   Driver Information
      DriverType:         MATLAB generic
      DriverName:         picotech_ps6000_generic.mdd
      DriverVersion:      1.2.20
 
   Communication State
      Status:             open

Setting Device Parameters...

Default Channel Setup:-
-----------------------

ChannelA:-
	Enabled: True
	Coupling: DC
	Range:5V
	Analogue Offset: 0.0 V
	Bandwidth: Full

ChannelB:-
	Enabled: True
	Coupling: DC
	Range:5V
	Analogue Offset: 0.0 V
	Bandwidth: Full

ChannelC:-
	Enabled: True
	Coupling: DC
	Range:5V
	Analogue Offset: 0.0 V
	Bandwidth: Full

ChannelD:-
	Enabled: True
	Coupling: DC
	Range:5V
	Analogue Offset: 0.0 V
	Bandwidth: Full

Turning off Equivalent Time Sampling...
Turning off trigger...

Default Block mode parameters:-

               Timebase index : 161
                 Time Interval: 1004.8 ns
 Number of pre-trigger samples: 0
Number of post-trigger samples: 1000000
       Total number of samples: 1000000

Default Streaming mode parameters:-

 Streaming interval: 1.00e-06 s
Streaming auto stop: 1

Default Signal generator parameters:-

      Start frequency: 1000 Hz
       Stop frequency: 1000 Hz
       Offset voltage: 0 mV
 Peak to Peak voltage: 2000 mV

Initialisation complete.

Connected to PicoScope 6000 Series device:-

      Instrument Model: 6404D
   Batch/Serial Number: EW421/006
     Analogue Channels: 4
             Bandwidth: 500 MHz
         Buffer memory: 2048 MS
 Maximum sampling rate: 5 GS/s
 Signal Generator Type: Arbitrary Waveform Generator

</pre><h2 id="5">Set Channels</h2><p>Default driver settings applied to channels are listed below - use ps6000SetChannel to turn channels on or off and set voltage ranges, coupling, as well as analogue offset.</p><pre class="codeinput"><span class="comment">% In this example, data is only collected on Channel A so default settings</span>
<span class="comment">% are used and Channels B, C and D are switched off.</span>

<span class="comment">% Channels       : 1 - 3 (ps6000Enuminfo.enPS6000Channel.PS6000_CHANNEL_B - PS6000_CHANNEL_D)</span>
<span class="comment">% Enabled        : 0 (off)</span>
<span class="comment">% Type           : 1 (ps6000Enuminfo.enPS6000Coupling.PS6000_DC_1M)</span>
<span class="comment">% Range          : 3 (ps6000Enuminfo.enPS6000Range.PS6000_100MV) for the PicoScope 6407 or</span>
<span class="comment">%                  8 (ps6000Enuminfo.enPS6000Range.PS6000_5V) for all other PicoScope 6000 Series models</span>
<span class="comment">% Analogue Offset: 0.0</span>
<span class="comment">% Bandwidth      : 0 (ps6000Enuminfo.enPS6000BandwidthLimiter.PS6000_BW_FULL)</span>

<span class="comment">% Select the correct voltage range and coupling to use</span>

voltageRangeIndex = ps6000Enuminfo.enPS6000Range.PS6000_5V;
coupling          = ps6000Enuminfo.enPS6000Coupling.PS6000_DC_1M;

<span class="keyword">if</span> (strcmp(ps6000DeviceObj.InstrumentModel, PS6000Constants.MODEL_PS6407))

    voltageRangeIndex = ps6000Enuminfo.enPS6000Range.PS6000_100MV;
    coupling          = ps6000Enuminfo.enPS6000Coupling.PS6000_DC_50R;

<span class="keyword">end</span>

<span class="comment">% Execute device object function(s).</span>
[status.setChB] = invoke(ps6000DeviceObj, <span class="string">'ps6000SetChannel'</span>, 1, 0, coupling, voltageRangeIndex, 0.0, 0);
[status.setChC] = invoke(ps6000DeviceObj, <span class="string">'ps6000SetChannel'</span>, 2, 0, coupling, voltageRangeIndex, 0.0, 0);
[status.setChD] = invoke(ps6000DeviceObj, <span class="string">'ps6000SetChannel'</span>, 3, 0, coupling, voltageRangeIndex, 0.0, 0);
</pre><h2 id="6">Verify Timebase Index and Maximum Number of Samples</h2><p>Driver default timebase index used - use ps6000GetTimebase2 to query the driver as to suitability of using a particular timebase index and the maximum number of samples available in the segment selected (the buffer memory has not been segmented in this example) then set the 'timebase' property if required.</p><p>To use the fastest sampling interval possible, set one analogue channel and turn off all other channels.</p><p>Use a while loop to query the function until the status indicates that a valid timebase index has been selected. In this example, the timebase index of 161 is valid.</p><pre class="codeinput"><span class="comment">% Initial call to ps6000GetTimebase2 with parameters:</span>
<span class="comment">% timebase      : 161</span>
<span class="comment">% segment index : 0</span>

status.getTimebase2 = PicoStatus.PICO_INVALID_TIMEBASE;
timebaseIndex       = get(ps6000DeviceObj, <span class="string">'timebase'</span>);

<span class="keyword">while</span>(status.getTimebase2 == PicoStatus.PICO_INVALID_TIMEBASE)

	[status.getTimebase2, timeIntervalNanoSeconds, maxSamples] = invoke(ps6000DeviceObj, <span class="string">'ps6000GetTimebase2'</span>, timebaseIndex, 0);

    <span class="keyword">if</span> (status.getTimebase2 == PicoStatus.PICO_OK)

        <span class="keyword">break</span>;

    <span class="keyword">else</span>

        timebaseIndex = timebaseIndex + 1;

    <span class="keyword">end</span>

<span class="keyword">end</span>

set(ps6000DeviceObj, <span class="string">'timebase'</span>, timebaseIndex);
</pre><h2 id="7">Set Simple Trigger</h2><p>Set a trigger on Channel A, with an auto timeout - the default value for delay is used.</p><pre class="codeinput"><span class="comment">% Trigger properties and functions are located in the Instrument</span>
<span class="comment">% Driver's Trigger group.</span>

triggerGroupObj = get(ps6000DeviceObj, <span class="string">'Trigger'</span>);
triggerGroupObj = triggerGroupObj(1);

<span class="comment">% Set the autoTriggerMs property in order to automatically trigger the</span>
<span class="comment">% oscilloscope after 1 second if a trigger event has not occurred. Set to 0 to</span>
<span class="comment">% wait indefinitely for a trigger event.</span>

set(triggerGroupObj, <span class="string">'autoTriggerMs'</span>, 1000);

<span class="comment">% Channel     : 0 (ps6000Enuminfo.enPS6000Channel.PS6000_CHANNEL_A)</span>
<span class="comment">% Threshold   : 50 mV (for the PicoScope 6407) or 500 mV otherwise</span>
<span class="comment">% Direction   : 2 (ps6000Enuminfo.enPS6000ThresholdDirection.PS6000_RISING)</span>

thresholdVoltage = 500;

<span class="keyword">if</span> (strcmp(ps6000DeviceObj.InstrumentModel, PS6000Constants.MODEL_PS6407))

    thresholdVoltage = 50;

<span class="keyword">end</span>

[status.setSimpleTrigger] = invoke(triggerGroupObj, <span class="string">'setSimpleTrigger'</span>, 0, thresholdVoltage, 2);
</pre><h2 id="8">Set Block Parameters and Capture Data</h2><p>Capture a block of data and retrieve data values for Channel A.</p><pre class="codeinput"><span class="comment">% Block data acquisition properties and functions are located in the</span>
<span class="comment">% Instrument Driver's Block group.</span>

blockGroupObj = get(ps6000DeviceObj, <span class="string">'Block'</span>);
blockGroupObj = blockGroupObj(1);

<span class="comment">% Set pre-trigger and post-trigger samples as required - the total of this should</span>
<span class="comment">% not exceed the value of maxSamples returned from the call to ps6000GetTimebase2.</span>

set(ps6000DeviceObj, <span class="string">'numPreTriggerSamples'</span>, 500e3);
set(ps6000DeviceObj, <span class="string">'numPostTriggerSamples'</span>, 500e3);
</pre><p>This example uses the <i>runBlock</i> function in order to collect a block of data - if other code needs to be executed while waiting for the device to indicate that it is ready, use the <i>ps6000RunBlock</i> function and poll the <i>ps6000IsReady</i> function.</p><pre class="codeinput"><span class="comment">% Capture a block of data:</span>
<span class="comment">%</span>
<span class="comment">% segment index: 0 (The buffer memory is not segmented in this example)</span>

[status.runBlock] = invoke(blockGroupObj, <span class="string">'runBlock'</span>, 0);

<span class="comment">% Retrieve data values:</span>
<span class="comment">%</span>
<span class="comment">% start index       : 0</span>
<span class="comment">% segment index     : 0</span>
<span class="comment">% downsampling ratio: 1</span>
<span class="comment">% downsampling mode : 0 (ps6000Enuminfo.enPS6000RatioMode.PS6000_RATIO_MODE_NONE)</span>

<span class="comment">% Provide additional output arguments for the remaining channels e.g. chB</span>
<span class="comment">% for Channel B</span>
[numSamples, overflow, chA, ~, ~, ~] = invoke(blockGroupObj, <span class="string">'getBlockData'</span>, 0, 0, 1, 0);

<span class="comment">% Stop the device</span>
[status.stop] = invoke(ps6000DeviceObj, <span class="string">'ps6000Stop'</span>);
</pre><pre class="codeoutput">runBlock:- Collecting block of data:
	Timebase: 161
	Pre-trigger samples: 500000
	Post-trigger samples: 500000
runBlock: Waiting for device to become ready...
runBlock: Device ready.

getBlockData: Setting up data buffers...
getBlockData: Retrieving data...
getBlockData: Assigning data to array and converting to milliVolts.
getBlockData: Data succesfully retrieved.
</pre><h2 id="10">Process Data</h2><p>Plot data values, calculate and plot FFT.</p><pre class="codeinput">figure1 = figure(<span class="string">'Name'</span>,<span class="string">'PicoScope 6000 Series Example - Block Mode Capture with FFT'</span>, <span class="keyword">...</span>
    <span class="string">'NumberTitle'</span>, <span class="string">'off'</span>);

<span class="comment">% Calculate time (nanoseconds) and convert to milliseconds</span>
<span class="comment">% Use timeIntervalNanoSeconds output from ps6000GetTimebase2</span>
<span class="comment">% or calculate it using the main Programmer's Guide.</span>

timeNs = double(timeIntervalNanoSeconds) * double(0:numSamples - 1);
timeMs = timeNs / 1e6;

<span class="comment">% Channel A</span>

chAAxes = subplot(2,1,1);
plot(chAAxes,timeMs, chA, <span class="string">'b'</span>);

<span class="keyword">if</span> (strcmp(ps6000DeviceObj.InstrumentModel, PS6000Constants.MODEL_PS6407))

    ylim(chAAxes, [-100 100]);

<span class="keyword">else</span>

    ylim(chAAxes, [-2000 2000]);

<span class="keyword">end</span>

title(chAAxes, <span class="string">'Block Data Acquisition'</span>);
xlabel(chAAxes, <span class="string">'Time (ms)'</span>);
ylabel(chAAxes, <span class="string">'Voltage (mV)'</span>);

grid(chAAxes, <span class="string">'on'</span>);
legend(chAAxes, <span class="string">'Channel A'</span>);

<span class="comment">% Calculate FFT of Channel A and plot - based on &lt;matlab:doc('fft') fft documentation&gt;.</span>
L = length(chA);
NFFT = 2 ^ nextpow2(L); <span class="comment">% Next power of 2 from length of y</span>
Y = fft(chA, NFFT) / L;

Fs = 1 / (timeIntervalNanoSeconds * 1e-9);
f = Fs/2 * linspace(0, 0.001, floor(((NFFT/2)/1000) + 1)); <span class="comment">% Reduce number of points by factor of 1000</span>

chAFFTAxes = subplot(2,1,2);
plot(chAFFTAxes, f, 2 * abs(Y(1: floor(((NFFT/2)/1000) + 1)) ));
title(chAFFTAxes, <span class="string">'Single-Sided Amplitude Spectrum of y(t)'</span>);
xlabel(chAFFTAxes, <span class="string">'Frequency (Hz)'</span>);
ylabel(chAFFTAxes, <span class="string">'|Y(f)|'</span>);
grid(chAFFTAxes, <span class="string">'on'</span>);
</pre><img vspace="5" hspace="5" src="PS6000_ID_Block_FFT_Example_01.png" alt=""> <h2 id="11">Disconnect Device</h2><pre class="codeinput"><span class="comment">% Disconnect device object from hardware.</span>
disconnect(ps6000DeviceObj);
delete(ps6000DeviceObj);
</pre><pre class="codeoutput">Connection to PicoScope 6404D with serial number EW421/006 closed successfully.
Libraries unloaded successfully.
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2017a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% PicoScope 6000 Series Instrument Driver Oscilloscope Block Data Capture with FFT Example
% This is an example of an instrument control session using a device 
% object. The instrument control session comprises all the steps you 
% are likely to take when communicating with your instrument. 
%       
% These steps are:
%    
% # Create a device object
% # Connect to the instrument
% # Configure properties
% # Invoke functions
% # Disconnect from the instrument
%  
% To run the instrument control session, type the name of the file,
% PS6000_ID_Block_Example_FFT, at the MATLAB command prompt.
% 
% The file, PS6000_ID_BLOCK_FFT_EXAMPLE.M must be on your MATLAB
% PATH. For additional information on setting your MATLAB PATH, type
% 'help addpath' at the MATLAB command prompt.
%
% *Example:*
%     PS6000_ID_Block_FFT_Example;
%
% *Description:*
%     Demonstrates how to set properties and call functions in order to capture a block of
%     data from a PicoScope 6000 Series Oscilloscope and calculate a Fast
%     Fourier Transform (FFT) on the data collected.
%
% *See also:* <matlab:doc('fft') |fft|> | <matlab:doc('icdevice') |icdevice|> |
% <matlab:doc('instrument/invoke') |invoke|>
%
% *Copyright:* © 2014 - 2017 Pico Technology Ltd. See LICENSE file for terms.

%% Suggested Input Test Signal
% This example was published using the following test signal:
%
% * Channel A: 4 Vpp, 50 Hz square wave

%% Clear Command Window and Close any Figures

clc;
close all;

%% Load Configuration Information
PS6000Config;

%% Device Connection

% Check if an Instrument session using the device object 'ps6000DeviceObj'
% is still open, and if so, disconnect if the User chooses 'Yes' when prompted.
if (exist('ps6000DeviceObj', 'var') && ps6000DeviceObj.isvalid && strcmp(ps6000DeviceObj.status, 'open'))
    
    openDevice = questionDialog(['Device object ps6000DeviceObj has an open connection. ' ...
        'Do you wish to close the connection and continue?'], ...
        'Device Object Connection Open');
    
    if (openDevice == PicoConstants.TRUE)
        
        % Close connection to device
        disconnect(ps6000DeviceObj);
        delete(ps6000DeviceObj);
        
    else

        % Exit script if User selects 'No'
        return;
        
    end
    
end

% Create a device object. 
% The serial number can be specified as a second input parameter.
ps6000DeviceObj = icdevice('picotech_ps6000_generic.mdd');

% Connect device object to hardware.
connect(ps6000DeviceObj);

%% Set Channels
% Default driver settings applied to channels are listed below - 
% use ps6000SetChannel to turn channels on or off and set voltage ranges, 
% coupling, as well as analogue offset.

% In this example, data is only collected on Channel A so default settings
% are used and Channels B, C and D are switched off.

% Channels       : 1 - 3 (ps6000Enuminfo.enPS6000Channel.PS6000_CHANNEL_B - PS6000_CHANNEL_D)
% Enabled        : 0 (off)
% Type           : 1 (ps6000Enuminfo.enPS6000Coupling.PS6000_DC_1M)
% Range          : 3 (ps6000Enuminfo.enPS6000Range.PS6000_100MV) for the PicoScope 6407 or 
%                  8 (ps6000Enuminfo.enPS6000Range.PS6000_5V) for all other PicoScope 6000 Series models
% Analogue Offset: 0.0
% Bandwidth      : 0 (ps6000Enuminfo.enPS6000BandwidthLimiter.PS6000_BW_FULL)

% Select the correct voltage range and coupling to use

voltageRangeIndex = ps6000Enuminfo.enPS6000Range.PS6000_5V;
coupling          = ps6000Enuminfo.enPS6000Coupling.PS6000_DC_1M;

if (strcmp(ps6000DeviceObj.InstrumentModel, PS6000Constants.MODEL_PS6407))

    voltageRangeIndex = ps6000Enuminfo.enPS6000Range.PS6000_100MV;
    coupling          = ps6000Enuminfo.enPS6000Coupling.PS6000_DC_50R;
   
end

% Execute device object function(s).
[status.setChB] = invoke(ps6000DeviceObj, 'ps6000SetChannel', 1, 0, coupling, voltageRangeIndex, 0.0, 0);
[status.setChC] = invoke(ps6000DeviceObj, 'ps6000SetChannel', 2, 0, coupling, voltageRangeIndex, 0.0, 0);
[status.setChD] = invoke(ps6000DeviceObj, 'ps6000SetChannel', 3, 0, coupling, voltageRangeIndex, 0.0, 0);

%% Verify Timebase Index and Maximum Number of Samples
% Driver default timebase index used - use ps6000GetTimebase2 to query the
% driver as to suitability of using a particular timebase index and the
% maximum number of samples available in the segment selected (the buffer
% memory has not been segmented in this example) then set the 'timebase'
% property if required.
%
% To use the fastest sampling interval possible, set one analogue channel
% and turn off all other channels.
%
% Use a while loop to query the function until the status indicates that a
% valid timebase index has been selected. In this example, the timebase 
% index of 161 is valid. 

% Initial call to ps6000GetTimebase2 with parameters:
% timebase      : 161
% segment index : 0

status.getTimebase2 = PicoStatus.PICO_INVALID_TIMEBASE;
timebaseIndex       = get(ps6000DeviceObj, 'timebase');

while(status.getTimebase2 == PicoStatus.PICO_INVALID_TIMEBASE)

	[status.getTimebase2, timeIntervalNanoSeconds, maxSamples] = invoke(ps6000DeviceObj, 'ps6000GetTimebase2', timebaseIndex, 0);
	
    if (status.getTimebase2 == PicoStatus.PICO_OK)
       
        break;
        
    else
        
        timebaseIndex = timebaseIndex + 1;
        
    end

end

set(ps6000DeviceObj, 'timebase', timebaseIndex);

%% Set Simple Trigger
% Set a trigger on Channel A, with an auto timeout - the default value for
% delay is used.

% Trigger properties and functions are located in the Instrument
% Driver's Trigger group.

triggerGroupObj = get(ps6000DeviceObj, 'Trigger');
triggerGroupObj = triggerGroupObj(1);

% Set the autoTriggerMs property in order to automatically trigger the 
% oscilloscope after 1 second if a trigger event has not occurred. Set to 0 to
% wait indefinitely for a trigger event.

set(triggerGroupObj, 'autoTriggerMs', 1000);

% Channel     : 0 (ps6000Enuminfo.enPS6000Channel.PS6000_CHANNEL_A)
% Threshold   : 50 mV (for the PicoScope 6407) or 500 mV otherwise
% Direction   : 2 (ps6000Enuminfo.enPS6000ThresholdDirection.PS6000_RISING)

thresholdVoltage = 500;

if (strcmp(ps6000DeviceObj.InstrumentModel, PS6000Constants.MODEL_PS6407))
   
    thresholdVoltage = 50;
    
end

[status.setSimpleTrigger] = invoke(triggerGroupObj, 'setSimpleTrigger', 0, thresholdVoltage, 2);

%% Set Block Parameters and Capture Data
% Capture a block of data and retrieve data values for Channel A.

% Block data acquisition properties and functions are located in the 
% Instrument Driver's Block group.

blockGroupObj = get(ps6000DeviceObj, 'Block');
blockGroupObj = blockGroupObj(1);

% Set pre-trigger and post-trigger samples as required - the total of this should
% not exceed the value of maxSamples returned from the call to ps6000GetTimebase2.

set(ps6000DeviceObj, 'numPreTriggerSamples', 500e3);
set(ps6000DeviceObj, 'numPostTriggerSamples', 500e3);

%%
% This example uses the _runBlock_ function in order to collect a block of
% data - if other code needs to be executed while waiting for the device to
% indicate that it is ready, use the _ps6000RunBlock_ function and poll
% the _ps6000IsReady_ function.

% Capture a block of data:
%
% segment index: 0 (The buffer memory is not segmented in this example)

[status.runBlock] = invoke(blockGroupObj, 'runBlock', 0);

% Retrieve data values:
%
% start index       : 0
% segment index     : 0
% downsampling ratio: 1
% downsampling mode : 0 (ps6000Enuminfo.enPS6000RatioMode.PS6000_RATIO_MODE_NONE)

% Provide additional output arguments for the remaining channels e.g. chB
% for Channel B
[numSamples, overflow, chA, ~, ~, ~] = invoke(blockGroupObj, 'getBlockData', 0, 0, 1, 0);

% Stop the device
[status.stop] = invoke(ps6000DeviceObj, 'ps6000Stop');

%% Process Data
% Plot data values, calculate and plot FFT.

figure1 = figure('Name','PicoScope 6000 Series Example - Block Mode Capture with FFT', ...
    'NumberTitle', 'off');

% Calculate time (nanoseconds) and convert to milliseconds
% Use timeIntervalNanoSeconds output from ps6000GetTimebase2 
% or calculate it using the main Programmer's Guide.

timeNs = double(timeIntervalNanoSeconds) * double(0:numSamples - 1);
timeMs = timeNs / 1e6;

% Channel A

chAAxes = subplot(2,1,1);
plot(chAAxes,timeMs, chA, 'b');

if (strcmp(ps6000DeviceObj.InstrumentModel, PS6000Constants.MODEL_PS6407))
    
    ylim(chAAxes, [-100 100]);
    
else
    
    ylim(chAAxes, [-2000 2000]);
    
end

title(chAAxes, 'Block Data Acquisition');
xlabel(chAAxes, 'Time (ms)');
ylabel(chAAxes, 'Voltage (mV)');

grid(chAAxes, 'on');
legend(chAAxes, 'Channel A');

% Calculate FFT of Channel A and plot - based on <matlab:doc('fft') fft documentation>.
L = length(chA);
NFFT = 2 ^ nextpow2(L); % Next power of 2 from length of y
Y = fft(chA, NFFT) / L;

Fs = 1 / (timeIntervalNanoSeconds * 1e-9);
f = Fs/2 * linspace(0, 0.001, floor(((NFFT/2)/1000) + 1)); % Reduce number of points by factor of 1000

chAFFTAxes = subplot(2,1,2);
plot(chAFFTAxes, f, 2 * abs(Y(1: floor(((NFFT/2)/1000) + 1)) )); 
title(chAFFTAxes, 'Single-Sided Amplitude Spectrum of y(t)');
xlabel(chAFFTAxes, 'Frequency (Hz)');
ylabel(chAFFTAxes, '|Y(f)|');
grid(chAFFTAxes, 'on');

%% Disconnect Device

% Disconnect device object from hardware.
disconnect(ps6000DeviceObj);
delete(ps6000DeviceObj);

##### SOURCE END #####
--></body></html>